import{a as te}from"./chunk-LINETVEA.js";import{$ as F,A as w,Db as Q,G as _,Hb as ee,Ib as ie,La as A,M as g,N,Na as b,Qa as k,Ra as Z,Sa as U,T as M,Ta as H,U as C,Ua as f,Va as y,Wa as v,Ya as Y,ba as K,cb as x,db as z,eb as J,hb as V,j as S,k as R,kb as X,lb as q,mb as P,nb as o,ob as r,r as l,s as G,x as L,y as O,z as W,za as m}from"./chunk-ARPSXJKY.js";var ne=17,s={width:960,height:640},c={width:140,height:25},oe=500,E={left:"ArrowLeft",right:"ArrowRight"},a=20,j=400,re=5,I=7,T=25,u=7;var pe=()=>{let i=I+1,e=s.width/I-i*u/I,t=[];for(let n=0;n<re;n++)for(let p=0;p<I;p++)t.push({x:p*(e+u)+u,y:n*(T+u)+u,width:e,height:T});return t},se=(i,e)=>{let t=i.position.x+i.direction.x*e*j,n=i.position.y+i.direction.y*e*j,p=Math.min(Math.max(0,t),s.width-a),d=Math.min(Math.max(0,n),s.height-a);return{x:p,y:d}},ae=(i,e,t)=>{let n=i.x+a>=e&&i.x<=e+c.width&&i.y+a>=s.height-c.height,p=i.x<=0||i.x+a>=s.width,d=i.y<=0,h=i.y+a>=s.height,B=t.some(D=>$(i,D));return{paddle:n,floor:h,wall:p,ceiling:d,brick:B}},$=(i,e)=>i.x+a>=e.x&&i.x<=e.x+e.width&&i.y+a>=e.y&&i.y<=e.y+e.height,de=(i,{wall:e,brick:t,paddle:n,ceiling:p})=>({x:e?-i.direction.x:i.direction.x,y:t||n||p?-i.direction.y:i.direction.y}),le=i=>[E.left,E.right].includes(i);var ue=(i,e)=>({width:i,height:e}),be=(i,e,t)=>({width:i,height:e,left:t}),me=(i,e,t,n)=>({width:i,height:e,left:t,top:n});function fe(i,e){if(i&1&&(f(0,"div",3)(1,"span",7),x(2),y(),f(3,"span"),x(4," Press "),f(5,"span",8),x(6,"Space"),y(),x(7),y()()),i&2){let t=e;m(2),z(t.title),m(5),J(" to ",t.message," ")}}function ye(i,e){if(i&1&&(v(0,"div",4),o(1,"px"),o(2,"px"),o(3,"px"),o(4,"px")),i&2){let t=e.$implicit;b("ngStyle",P(9,me,r(1,1,t.width),r(2,3,t.height),r(3,5,t.x),r(4,7,t.y)))}}function xe(i,e){if(i&1&&(v(0,"div",5),o(1,"px"),o(2,"px"),o(3,"px"),o(4,"px")),i&2){let t=e,n=Y();b("ngStyle",P(9,me,r(1,1,n.BALL_RADIUS),r(2,3,n.BALL_RADIUS),r(3,5,t.x),r(4,7,t.y)))}}var ce=class i{document=F(Q);GAME_FIELD_SIZE=s;PADDLE_SIZE=c;BALL_RADIUS=a;INITIAL_OBJECTS={ball:{position:{x:s.width/2-a/2,y:s.height/2-a/2},direction:{x:1,y:1}},bricks:pe(),collisions:{paddle:!1,floor:!1,wall:!1,ceiling:!1,brick:!1}};infoWindowSubject=new S(null);infoWindow$=this.infoWindowSubject.asObservable();paddlePositionSubject=new S(s.width/2-c.width/2);paddlePosition$=this.paddlePositionSubject.pipe(_());objectsSubject=new S(this.INITIAL_OBJECTS);bricks$=this.objectsSubject.pipe(l(({bricks:e})=>e),_());ball$=this.objectsSubject.pipe(l(({ball:e})=>e.position),_());ticker$=O(ne,R).pipe(l(()=>({time:Date.now(),deltaTime:null})),g((e,t)=>({time:t.time,deltaTime:(t.time-e.time)/1e3})),w(({deltaTime:e})=>e!==null),l(e=>e),N(1));keydownEvent$=L(this.document,"keydown");keyupEvent$=L(this.document,"keyup");userInput$=W(this.keydownEvent$.pipe(l(({key:e})=>e),w(le),l(e=>e===E.left?-1:1)),this.keyupEvent$.pipe(l(()=>0)));paddle$=this.ticker$.pipe(C(this.userInput$),g((e,[t,n])=>{let d=s.width-c.width,h=e+n*t.deltaTime*oe;return Math.max(Math.min(h,d),0)},s.width/2-c.width/2));objects$=this.ticker$.pipe(C(this.paddle$),g(({ball:e,bricks:t},[n,p])=>{let d=se(e,n.deltaTime),h=ae(d,p,t),B=de(e,h),D=t.filter(he=>!$(d,he));return{ball:{position:d,direction:B},bricks:D,collisions:h}},this.INITIAL_OBJECTS));ngOnInit(){this.prepareNewGame({title:"WELCOME!",message:"start the game!"})}prepareNewGame(e){this.showInfoWindow(e),this.resetObjects(),this.setupStartGameListener()}showInfoWindow(e){this.infoWindowSubject.next(e)}closeInfoWindow(){this.infoWindowSubject.next(null)}resetObjects(){this.paddlePositionSubject.next(s.width/2-c.width/2),this.objectsSubject.next(this.INITIAL_OBJECTS)}setupStartGameListener(){let e=this.keydownEvent$.pipe(l(({key:t})=>t),w(t=>t===" "),M(()=>{this.closeInfoWindow(),this.startGame(),e.unsubscribe()})).subscribe()}startGame(){let e=G([this.ticker$,this.paddle$,this.objects$]).subscribe(([,t,n])=>{this.paddlePositionSubject.next(t),this.objectsSubject.next(n),n.collisions.floor&&(this.prepareNewGame({title:"GAME OVER!",message:"try again!"}),e.unsubscribe()),n.bricks.length||(this.prepareNewGame({title:"YOU WIN!",message:"play again!"}),e.unsubscribe())})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=K({type:i,selectors:[["app-breakout"]],standalone:!0,features:[V],decls:17,vars:29,consts:[[1,"flex","justify-center"],[1,"border","border-pink-400"],[1,"relative",3,"ngStyle"],[1,"absolute","left-1/2","top-1/4","z-10","flex","-translate-x-1/2","flex-col","items-center","gap-4","rounded-lg","bg-pink-700","p-4","text-white","shadow-xl","shadow-black/25"],[1,"absolute","rounded-sm","bg-blue-700",3,"ngStyle"],[1,"absolute","rounded-full","bg-red-800",3,"ngStyle"],[1,"absolute","bottom-0","rounded-sm","bg-pink-700",3,"ngStyle"],[1,"text-2xl"],[1,"rounded-md","border","border-b-2","border-gray-400","bg-white","px-2","py-0.5","text-gray-400"]],template:function(t,n){if(t&1&&(f(0,"div",0)(1,"div",1)(2,"div",2),o(3,"px"),o(4,"px"),A(5,fe,8,2,"div",3),o(6,"async"),U(7,ye,5,14,"div",4,Z),o(9,"async"),A(10,xe,5,14,"div",5),o(11,"async"),v(12,"div",6),o(13,"px"),o(14,"px"),o(15,"async"),o(16,"px"),y()()()),t&2){let p,d;m(2),b("ngStyle",X(22,ue,r(3,4,n.GAME_FIELD_SIZE.width),r(4,6,n.GAME_FIELD_SIZE.height))),m(3),k((p=r(6,8,n.infoWindow$))?5:-1,p),m(2),H(r(9,10,n.bricks$)),m(3),k((d=r(11,12,n.ball$))?10:-1,d),m(2),b("ngStyle",q(25,be,r(13,14,n.PADDLE_SIZE.width),r(14,16,n.PADDLE_SIZE.height),r(16,20,r(15,18,n.paddlePosition$))))}},dependencies:[ee,ie,te],changeDetection:0})};export{ce as BreakoutComponent};
