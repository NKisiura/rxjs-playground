import{d as ie,h as te,i as ne}from"./chunk-ALEGEUVN.js";import{$a as y,F as w,Ia as k,K as _,Ka as f,L as F,Na as P,Oa as H,Pa as Y,Q as M,Qa as z,R as A,Ra as b,Sa as x,Ta as v,Va as J,Y as K,_ as Z,aa as U,ab as V,bb as X,cb as q,db as Q,eb as ee,fb as $,gb as o,hb as r,i as S,j as G,q as d,r as O,w as C,wa as m,x as W,y as N,z as g}from"./chunk-YY4BF4QP.js";var B=class i{transform(e){return e?`${e.toString()}px`:null}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=U({name:"px",type:i,pure:!0,standalone:!0})};var oe=17,s={width:960,height:640},c={width:140,height:25},re=500,E={left:"ArrowLeft",right:"ArrowRight"},a=20,T=400,pe=5,I=7,j=25,h=7;var se=()=>{let i=I+1,e=s.width/I-i*h/I,t=[];for(let n=0;n<pe;n++)for(let p=0;p<I;p++)t.push({x:p*(e+h)+h,y:n*(j+h)+h,width:e,height:j});return t},ae=(i,e)=>{let t=i.position.x+i.direction.x*e*T,n=i.position.y+i.direction.y*e*T,p=Math.min(Math.max(0,t),s.width-a),l=Math.min(Math.max(0,n),s.height-a);return{x:p,y:l}},le=(i,e,t)=>{let n=i.x+a>=e&&i.x<=e+c.width&&i.y+a>=s.height-c.height,p=i.x<=0||i.x+a>=s.width,l=i.y<=0,u=i.y+a>=s.height,D=t.some(L=>R(i,L));return{paddle:n,floor:u,wall:p,ceiling:l,brick:D}},R=(i,e)=>i.x+a>=e.x&&i.x<=e.x+e.width&&i.y+a>=e.y&&i.y<=e.y+e.height,de=(i,{wall:e,brick:t,paddle:n,ceiling:p})=>({x:e?-i.direction.x:i.direction.x,y:t||n||p?-i.direction.y:i.direction.y}),ce=i=>[E.left,E.right].includes(i);var be=(i,e)=>({width:i,height:e}),xe=(i,e,t)=>({width:i,height:e,left:t}),ue=(i,e,t,n)=>({width:i,height:e,left:t,top:n});function ye(i,e){if(i&1&&(b(0,"div",3)(1,"span",7),y(2),x(),b(3,"span"),y(4," Press "),b(5,"span",8),y(6,"Space"),x(),y(7),x()()),i&2){let t=e;m(2),V(t.title),m(5),X(" to ",t.message," ")}}function Ee(i,e){if(i&1&&(v(0,"div",4),o(1,"px"),o(2,"px"),o(3,"px"),o(4,"px")),i&2){let t=e.$implicit;f("ngStyle",$(9,ue,r(1,1,t.width),r(2,3,t.height),r(3,5,t.x),r(4,7,t.y)))}}function Ie(i,e){if(i&1&&(v(0,"div",5),o(1,"px"),o(2,"px"),o(3,"px"),o(4,"px")),i&2){let t=e,n=J();f("ngStyle",$(9,ue,r(1,1,n.BALL_RADIUS),r(2,3,n.BALL_RADIUS),r(3,5,t.x),r(4,7,t.y)))}}var me=class i{document=K(ie);GAME_FIELD_SIZE=s;PADDLE_SIZE=c;BALL_RADIUS=a;INITIAL_OBJECTS={ball:{position:{x:s.width/2-a/2,y:s.height/2-a/2},direction:{x:1,y:1}},bricks:se(),collisions:{paddle:!1,floor:!1,wall:!1,ceiling:!1,brick:!1}};infoWindowSubject=new S(null);infoWindow$=this.infoWindowSubject.asObservable();paddlePositionSubject=new S(s.width/2-c.width/2);paddlePosition$=this.paddlePositionSubject.pipe(w());objectsSubject=new S(this.INITIAL_OBJECTS);bricks$=this.objectsSubject.pipe(d(({bricks:e})=>e),w());ball$=this.objectsSubject.pipe(d(({ball:e})=>e.position),w());ticker$=W(oe,G).pipe(d(()=>({time:Date.now(),deltaTime:null})),_((e,t)=>({time:t.time,deltaTime:(t.time-e.time)/1e3})),g(({deltaTime:e})=>e!==null),d(e=>e),F(1));keydownEvent$=C(this.document,"keydown");keyupEvent$=C(this.document,"keyup");userInput$=N(this.keydownEvent$.pipe(d(({key:e})=>e),g(ce),d(e=>e===E.left?-1:1)),this.keyupEvent$.pipe(d(()=>0)));paddle$=this.ticker$.pipe(A(this.userInput$),_((e,[t,n])=>{let l=s.width-c.width,u=e+n*t.deltaTime*re;return Math.max(Math.min(u,l),0)},s.width/2-c.width/2));objects$=this.ticker$.pipe(A(this.paddle$),_(({ball:e,bricks:t},[n,p])=>{let l=ae(e,n.deltaTime),u=le(l,p,t),D=de(e,u),L=t.filter(he=>!R(l,he));return{ball:{position:l,direction:D},bricks:L,collisions:u}},this.INITIAL_OBJECTS));ngOnInit(){this.prepareNewGame({title:"WELCOME!",message:"start the game!"})}prepareNewGame(e){this.showInfoWindow(e),this.resetObjects(),this.setupStartGameListener()}showInfoWindow(e){this.infoWindowSubject.next(e)}closeInfoWindow(){this.infoWindowSubject.next(null)}resetObjects(){this.paddlePositionSubject.next(s.width/2-c.width/2),this.objectsSubject.next(this.INITIAL_OBJECTS)}setupStartGameListener(){let e=this.keydownEvent$.pipe(d(({key:t})=>t),g(t=>t===" "),M(()=>{this.closeInfoWindow(),this.startGame(),e.unsubscribe()})).subscribe()}startGame(){let e=O([this.ticker$,this.paddle$,this.objects$]).subscribe(([,t,n])=>{this.paddlePositionSubject.next(t),this.objectsSubject.next(n),n.collisions.floor&&(this.prepareNewGame({title:"GAME OVER!",message:"try again!"}),e.unsubscribe()),n.bricks.length||(this.prepareNewGame({title:"YOU WIN!",message:"play again!"}),e.unsubscribe())})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Z({type:i,selectors:[["app-breakout"]],standalone:!0,features:[q],decls:17,vars:29,consts:[[1,"flex","justify-center"],[1,"border","border-pink-400"],[1,"relative",3,"ngStyle"],[1,"absolute","left-1/2","top-1/4","z-10","flex","-translate-x-1/2","flex-col","items-center","gap-4","rounded-lg","bg-pink-700","p-4","text-white","shadow-xl","shadow-black/25"],[1,"absolute","rounded-sm","bg-blue-700",3,"ngStyle"],[1,"absolute","rounded-full","bg-red-800",3,"ngStyle"],[1,"absolute","bottom-0","rounded-sm","bg-pink-700",3,"ngStyle"],[1,"text-2xl"],[1,"rounded-md","border","border-b-2","border-gray-400","bg-white","px-2","py-0.5","text-gray-400"]],template:function(t,n){if(t&1&&(b(0,"div",0)(1,"div",1)(2,"div",2),o(3,"px"),o(4,"px"),k(5,ye,8,2,"div",3),o(6,"async"),Y(7,Ee,5,14,"div",4,H),o(9,"async"),k(10,Ie,5,14,"div",5),o(11,"async"),v(12,"div",6),o(13,"px"),o(14,"px"),o(15,"async"),o(16,"px"),x()()()),t&2){let p,l;m(2),f("ngStyle",Q(22,be,r(3,4,n.GAME_FIELD_SIZE.width),r(4,6,n.GAME_FIELD_SIZE.height))),m(3),P((p=r(6,8,n.infoWindow$))?5:-1,p),m(2),z(r(9,10,n.bricks$)),m(3),P((l=r(11,12,n.ball$))?10:-1,l),m(2),f("ngStyle",ee(25,xe,r(13,14,n.PADDLE_SIZE.width),r(14,16,n.PADDLE_SIZE.height),r(16,20,r(15,18,n.paddlePosition$))))}},dependencies:[te,ne,B],changeDetection:0})};export{me as BreakoutComponent};
